{"sliceID":1205898264647890103,"uses":[{"reference":{"otherSlice":8638204322850705959},"usedName":{"valueName":{"identifier":"getProtocolNumber"}},"qualification":null},{"reference":{"otherSlice":8072899159494863221},"usedName":{"valueName":{"identifier":"defaultHints"}},"qualification":null},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrFlags"}},"qualification":null},{"reference":{"otherSlice":7274990277951535068},"usedName":{"constructorName":{"identifier":"AI_ADDRCONFIG"},"constructorTypeName":{"identifier":"AddrInfoFlag"}},"qualification":null},{"reference":{"otherSlice":7274990277951535068},"usedName":{"constructorName":{"identifier":"AI_PASSIVE"},"constructorTypeName":{"identifier":"AddrInfoFlag"}},"qualification":null},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrSocketType"}},"qualification":null},{"reference":{"otherSlice":3163448590057951563},"usedName":{"constructorName":{"identifier":"Stream"},"constructorTypeName":{"identifier":"SocketType"}},"qualification":null},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrProtocol"}},"qualification":null},{"reference":{"otherSlice":231875607056582677},"usedName":{"valueName":{"identifier":"getAddrInfo"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"filter"}},"qualification":null},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrFamily"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"otherSlice":4486329222352366024},"usedName":{"constructorName":{"identifier":"AF_INET6"},"constructorTypeName":{"identifier":"Family"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"null"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"head"}},"qualification":null},{"reference":{"otherSlice":6836808237061880546},"usedName":{"valueName":{"identifier":"bracketOnError"}},"qualification":null},{"reference":{"otherSlice":5388047469248839065},"usedName":{"valueName":{"identifier":"socket"}},"qualification":null},{"reference":{"otherSlice":1812067098603633874},"usedName":{"valueName":{"identifier":"sClose"}},"qualification":null},{"reference":{"otherSlice":5242549618965026866},"usedName":{"valueName":{"identifier":"setSocketOption"}},"qualification":null},{"reference":{"otherSlice":1193574024344381829},"usedName":{"constructorName":{"identifier":"ReuseAddr"},"constructorTypeName":{"identifier":"SocketOption"}},"qualification":null},{"reference":{"otherSlice":2237209920055623949},"usedName":{"valueName":{"identifier":"bindSocket"}},"qualification":null},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrAddress"}},"qualification":null},{"reference":{"otherSlice":877968498097418032},"usedName":{"valueName":{"identifier":"listen"}},"qualification":null},{"reference":{"otherSlice":5898727854107997666},"usedName":{"valueName":{"identifier":"maxListenQueue"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":7119013459298210253},"usedName":{"typeName":{"identifier":"ServiceName"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":3934872489478287384},"usedName":{"typeName":{"identifier":"Socket"}},"qualification":null}],"fragment":["listen' :: ServiceName -> IO Socket","listen' serv\n  = do proto <- getProtocolNumber \"tcp\"\n       let hints\n             = defaultHints{addrFlags = [AI_ADDRCONFIG, AI_PASSIVE],\n                            addrSocketType = Stream, addrProtocol = proto}\n       addrs <- getAddrInfo (Just hints) Nothing (Just serv)\n       let addrs' = filter (\\ x -> addrFamily x == AF_INET6) addrs\n           addr = if null addrs' then head addrs else head addrs'\n       bracketOnError\n         (socket (addrFamily addr) (addrSocketType addr)\n            (addrProtocol addr))\n         (sClose)\n         (\\ sock ->\n            do setSocketOption sock ReuseAddr 1\n               bindSocket sock (addrAddress addr)\n               listen sock maxListenQueue\n               return sock)"],"instances":[],"language":{"extensions":["DeriveDataTypeable","ForeignFunctionInterface","TypeSynonymInstances","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}