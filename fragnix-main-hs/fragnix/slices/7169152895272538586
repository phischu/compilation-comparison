{"sliceID":7169152895272538586,"uses":[{"reference":{"otherSlice":7372302851638669756},"usedName":{"valueName":{"identifier":"getClientCookies"}},"qualification":null},{"reference":{"otherSlice":2091718289232486777},"usedName":{"valueName":{"identifier":"append"}},"qualification":"T"},{"reference":{"otherSlice":5106837017332568962},"usedName":{"valueName":{"identifier":"intercalate"}},"qualification":"T"},{"reference":{"otherSlice":9025559142516147699},"usedName":{"valueName":{"identifier":"pathInfo"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad.IO.Class"},"usedName":{"valueName":{"identifier":"liftIO"}},"qualification":null},{"reference":{"otherSlice":3520656688728995171},"usedName":{"valueName":{"identifier":"getCurrentTime"}},"qualification":null},{"reference":{"otherSlice":6375091947813588836},"usedName":{"valueName":{"identifier":"filter"}},"qualification":"Map"},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"&&"}},"qualification":null},{"reference":{"otherSlice":3208799123422311968},"usedName":{"valueName":{"identifier":"setCookieName"}},"qualification":"Cookie"},{"reference":{"otherSlice":3208799123422311968},"usedName":{"valueName":{"identifier":"setCookieValue"}},"qualification":"Cookie"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"map"}},"qualification":null},{"reference":{"builtinModule":"Data.Tuple"},"usedName":{"valueName":{"identifier":"snd"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":6217887341596637738},"usedName":{"valueName":{"identifier":"toList"}},"qualification":"Map"},{"reference":{"otherSlice":4649458711449220182},"usedName":{"valueName":{"identifier":"toByteString"}},"qualification":null},{"reference":{"otherSlice":7699333844778948933},"usedName":{"valueName":{"identifier":"renderCookies"}},"qualification":"Cookie"},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"null"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":9025559142516147699},"usedName":{"valueName":{"identifier":"requestHeaders"}},"qualification":null},{"reference":{"otherSlice":3208799123422311968},"usedName":{"valueName":{"identifier":"setCookieExpires"}},"qualification":"Cookie"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"<"}},"qualification":null},{"reference":{"otherSlice":3208799123422311968},"usedName":{"valueName":{"identifier":"setCookiePath"}},"qualification":"Cookie"},{"reference":{"otherSlice":6327919249248331934},"usedName":{"valueName":{"identifier":"isPrefixOf"}},"qualification":"S8"},{"reference":{"otherSlice":852164309766314520},"usedName":{"valueName":{"identifier":"encodeUtf8"}},"qualification":"TE"},{"reference":{"otherSlice":9025559142516147699},"usedName":{"typeName":{"identifier":"Request"}},"qualification":null},{"reference":{"otherSlice":8642581281670190790},"usedName":{"typeName":{"identifier":"Session"}},"qualification":null}],"fragment":["addCookiesToRequest :: Request -> Session Request","addCookiesToRequest req\n  = do oldClientCookies <- getClientCookies\n       let requestPath = \"/\" `T.append` T.intercalate \"/\" (pathInfo req)\n       currentUTCTime <- liftIO getCurrentTime\n       let cookiesForRequest\n             = Map.filter\n                 (\\ c ->\n                    checkCookieTime currentUTCTime c && checkCookiePath requestPath c)\n                 oldClientCookies\n       let cookiePairs\n             = [(Cookie.setCookieName c, Cookie.setCookieValue c) |\n                c <- map snd $ Map.toList cookiesForRequest]\n       let cookieValue = toByteString $ Cookie.renderCookies cookiePairs\n           addCookieHeader rest\n             | null cookiePairs = rest\n             | otherwise = (\"Cookie\", cookieValue) : rest\n       return $ req{requestHeaders = addCookieHeader $ requestHeaders req}\n  where checkCookieTime t c\n          = case Cookie.setCookieExpires c of\n                Nothing -> True\n                Just t' -> t < t'\n        checkCookiePath p c\n          = case Cookie.setCookiePath c of\n                Nothing -> True\n                Just p' -> p' `S8.isPrefixOf` TE.encodeUtf8 p"],"instances":[],"language":{"extensions":["OverloadedStrings","DeriveDataTypeable","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}