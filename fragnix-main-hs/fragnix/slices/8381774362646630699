{"sliceID":8381774362646630699,"uses":[{"reference":{"otherSlice":4040851656968671632},"usedName":{"valueName":{"identifier":"settingsFork"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"bracket"}},"qualification":null},{"reference":{"otherSlice":6005062748871305151},"usedName":{"valueName":{"identifier":"registerKillThread"}},"qualification":"T"},{"reference":{"otherSlice":7989376555219399377},"usedName":{"valueName":{"identifier":"cancel"}},"qualification":"T"},{"reference":{"otherSlice":3323754789693346301},"usedName":{"constructorName":{"identifier":"InternalInfo"},"constructorTypeName":{"identifier":"InternalInfo"}},"qualification":null},{"reference":{"otherSlice":4790797952279457416},"usedName":{"valueName":{"identifier":"setSendFile"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"."}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"handle"}},"qualification":null},{"reference":{"otherSlice":355629517602467088},"usedName":{"valueName":{"identifier":"onE"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"when"}},"qualification":null},{"reference":{"otherSlice":7487104842264301229},"usedName":{"valueName":{"identifier":"serveConnection"}},"qualification":null},{"reference":{"otherSlice":4881703223122348873},"usedName":{"valueName":{"identifier":"connClose"}},"qualification":null},{"reference":{"otherSlice":2152432049414133784},"usedName":{"valueName":{"identifier":"increase"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":">>"}},"qualification":null},{"reference":{"otherSlice":4040851656968671632},"usedName":{"valueName":{"identifier":"settingsOnOpen"}},"qualification":null},{"reference":{"otherSlice":2121217888858007532},"usedName":{"valueName":{"identifier":"decrease"}},"qualification":null},{"reference":{"otherSlice":4040851656968671632},"usedName":{"valueName":{"identifier":"settingsOnClose"}},"qualification":null},{"reference":{"otherSlice":4040851656968671632},"usedName":{"typeName":{"identifier":"Settings"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":4881703223122348873},"usedName":{"typeName":{"identifier":"Connection"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"otherSlice":5051683172608853772},"usedName":{"typeName":{"identifier":"SockAddr"}},"qualification":null},{"reference":{"otherSlice":2500932139194697081},"usedName":{"typeName":{"identifier":"Application"}},"qualification":null},{"reference":{"otherSlice":4025988212302271313},"usedName":{"typeName":{"identifier":"DateCache"}},"qualification":"D"},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"typeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"otherSlice":7407983818533495161},"usedName":{"typeName":{"identifier":"MutableFdCache"}},"qualification":"F"},{"reference":{"otherSlice":7271469853572783616},"usedName":{"typeName":{"identifier":"Manager"}},"qualification":"T"},{"reference":{"otherSlice":3451900265030802778},"usedName":{"typeName":{"identifier":"Counter"}},"qualification":null}],"fragment":["fork ::\n     Settings ->\n       IO (Connection, Bool) ->\n         SockAddr ->\n           Application ->\n             D.DateCache ->\n               Maybe F.MutableFdCache -> T.Manager -> Counter -> IO ()","fork set mkConn addr app dc fc tm counter\n  = settingsFork set $\n      \\ unmask ->\n        bracket mkConn closeConn $\n          \\ (conn0, isSecure') ->\n            bracket (T.registerKillThread tm) T.cancel $\n              \\ th ->\n                let ii = InternalInfo th fc dc\n                    conn = setSendFile conn0 fc\n                  in\n                  unmask .\n                    handle (onE set Nothing) . bracket (onOpen addr) (onClose addr)\n                    $\n                    \\ goingon ->\n                      when goingon $ serveConnection conn ii addr isSecure' set app\n  where closeConn (conn, _isSecure) = connClose conn\n        onOpen adr = increase counter >> settingsOnOpen set adr\n        onClose adr _ = decrease counter >> settingsOnClose set adr"],"instances":[],"language":{"extensions":["OverloadedStrings","ScopedTypeVariables","TupleSections","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}