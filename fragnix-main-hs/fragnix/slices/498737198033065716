{"sliceID":498737198033065716,"uses":[{"reference":{"otherSlice":4388261176215324957},"usedName":{"constructorName":{"identifier":"ResponseStream"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":4388261176215324957},"usedName":{"constructorName":{"identifier":"ResponseFile"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"System.IO"},"usedName":{"valueName":{"identifier":"withBinaryFile"}},"qualification":"IO"},{"reference":{"builtinModule":"GHC.IO.IOMode"},"usedName":{"constructorName":{"identifier":"ReadMode"},"constructorTypeName":{"identifier":"IOMode"}},"qualification":"IO"},{"reference":{"builtinModule":"GHC.IO.Handle"},"usedName":{"valueName":{"identifier":"hSeek"}},"qualification":"IO"},{"reference":{"builtinModule":"GHC.IO.Device"},"usedName":{"constructorName":{"identifier":"AbsoluteSeek"},"constructorTypeName":{"identifier":"SeekMode"}},"qualification":"IO"},{"reference":{"otherSlice":6996604809212615647},"usedName":{"valueName":{"identifier":"filePartOffset"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"<="}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":7791654261413892396},"usedName":{"valueName":{"identifier":"hGetSome"}},"qualification":"B"},{"reference":{"otherSlice":6370398503432730163},"usedName":{"valueName":{"identifier":"defaultChunkSize"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"unless"}},"qualification":null},{"reference":{"otherSlice":675696118971413715},"usedName":{"valueName":{"identifier":"null"}},"qualification":"B"},{"reference":{"otherSlice":3093287715237579077},"usedName":{"valueName":{"identifier":"take"}},"qualification":"B"},{"reference":{"otherSlice":5870116409610916390},"usedName":{"valueName":{"identifier":"fromByteString"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null},{"reference":{"otherSlice":6258463563638113276},"usedName":{"valueName":{"identifier":"length"}},"qualification":"B"},{"reference":{"builtinModule":"GHC.Real"},"usedName":{"valueName":{"identifier":"fromIntegral"}},"qualification":null},{"reference":{"otherSlice":6996604809212615647},"usedName":{"valueName":{"identifier":"filePartByteCount"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"Data.Function"},"usedName":{"valueName":{"identifier":"fix"}},"qualification":null},{"reference":{"otherSlice":4388261176215324957},"usedName":{"constructorName":{"identifier":"ResponseBuilder"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"otherSlice":4388261176215324957},"usedName":{"constructorName":{"identifier":"ResponseRaw"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"otherSlice":4388261176215324957},"usedName":{"typeName":{"identifier":"Response"}},"qualification":null},{"reference":{"otherSlice":5548762664127723913},"usedName":{"typeName":{"identifier":"Status"}},"qualification":"H"},{"reference":{"otherSlice":8689147996023585074},"usedName":{"typeName":{"identifier":"ResponseHeaders"}},"qualification":"H"},{"reference":{"otherSlice":610443982053993315},"usedName":{"typeName":{"identifier":"StreamingBody"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null}],"fragment":["responseToStream ::\n                 Response ->\n                   (H.Status, H.ResponseHeaders, (StreamingBody -> IO a) -> IO a)","responseToStream (ResponseStream s h b) = (s, h, ($ b))\nresponseToStream (ResponseFile s h fp (Just part))\n  = (s, h,\n     \\ withBody ->\n       IO.withBinaryFile fp IO.ReadMode $\n         \\ handle ->\n           withBody $\n             \\ sendChunk _flush ->\n               do IO.hSeek handle IO.AbsoluteSeek $ filePartOffset part\n                  let loop remaining | remaining <= 0 = return ()\n                      loop remaining\n                        = do bs <- B.hGetSome handle defaultChunkSize\n                             unless (B.null bs) $\n                               do let x = B.take remaining bs\n                                  sendChunk $ fromByteString x\n                                  loop $ remaining - B.length x\n                  loop $ fromIntegral $ filePartByteCount part)\nresponseToStream (ResponseFile s h fp Nothing)\n  = (s, h,\n     \\ withBody ->\n       IO.withBinaryFile fp IO.ReadMode $\n         \\ handle ->\n           withBody $\n             \\ sendChunk _flush ->\n               fix $\n                 \\ loop ->\n                   do bs <- B.hGetSome handle defaultChunkSize\n                      unless (B.null bs) $\n                        do sendChunk $ fromByteString bs\n                           loop)\nresponseToStream (ResponseBuilder s h b)\n  = (s, h,\n     \\ withBody -> withBody $ \\ sendChunk _flush -> sendChunk b)\nresponseToStream (ResponseRaw _ res) = responseToStream res"],"instances":[],"language":{"extensions":["Rank2Types","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}