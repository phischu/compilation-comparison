{"sliceID":2042820688186666015,"uses":[{"reference":{"otherSlice":3790782889836978137},"usedName":{"typeName":{"identifier":"JSONClass"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"Data.Traversable"},"usedName":{"valueName":{"identifier":"mapM"}},"qualification":null},{"reference":{"otherSlice":5641749074508611076},"usedName":{"valueName":{"identifier":"expandSyn"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Int"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"length"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null},{"reference":{"otherSlice":4299504902901625159},"usedName":{"valueName":{"identifier":"arityInt"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"drop"}},"qualification":null},{"reference":{"otherSlice":4571298986856964077},"usedName":{"typeName":{"identifier":"StarKindStatus"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"map"}},"qualification":null},{"reference":{"otherSlice":8203771097873248177},"usedName":{"valueName":{"identifier":"canRealizeKindStar"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"when"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"<"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"||"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"elem"}},"qualification":null},{"reference":{"otherSlice":4571298986856964077},"usedName":{"constructorName":{"identifier":"NotKindStar"},"constructorTypeName":{"identifier":"StarKindStatus"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":4769179467594993518},"usedName":{"valueName":{"identifier":"derivingKindError"}},"qualification":null},{"reference":{"otherSlice":3021894535397844320},"usedName":{"valueName":{"identifier":"catKindVarNames"}},"qualification":null},{"reference":{"otherSlice":1037365471341616905},"usedName":{"valueName":{"identifier":"substNamesWithKindStar"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"splitAt"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"concatMap"}},"qualification":null},{"reference":{"otherSlice":9167962748653740486},"usedName":{"valueName":{"identifier":"tyVarNamesOfType"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"unless"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"all"}},"qualification":null},{"reference":{"otherSlice":8145810287573649970},"usedName":{"valueName":{"identifier":"hasKindStar"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"typeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"unzip"}},"qualification":null},{"reference":{"otherSlice":8502723437003528404},"usedName":{"valueName":{"identifier":"deriveConstraint"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"concat"}},"qualification":null},{"reference":{"builtinModule":"Data.List"},"usedName":{"valueName":{"identifier":"union"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"take"}},"qualification":null},{"reference":{"otherSlice":794889801221550503},"usedName":{"valueName":{"identifier":"unSigT"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"valueName":{"identifier":"catMaybes"}},"qualification":null},{"reference":{"otherSlice":8046330048565132390},"usedName":{"valueName":{"identifier":"jsonClassName"}},"qualification":null},{"reference":{"otherSlice":8452572553788927079},"usedName":{"valueName":{"identifier":"applyTyCon"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"any"}},"qualification":null},{"reference":{"otherSlice":4079894071508297803},"usedName":{"valueName":{"identifier":"predMentionsName"}},"qualification":null},{"reference":{"otherSlice":8758010770189752423},"usedName":{"valueName":{"identifier":"datatypeContextError"}},"qualification":null},{"reference":{"otherSlice":6835790674644282624},"usedName":{"valueName":{"identifier":"canEtaReduce"}},"qualification":null},{"reference":{"otherSlice":4442219805947410926},"usedName":{"valueName":{"identifier":"etaReductionError"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null}],"fragment":["buildTypeInstanceFromTys ::\n                         Name -> JSONClass -> Cxt -> [Type] -> Bool -> Q (Cxt, Type)","buildTypeInstanceFromTys tyConName jc dataCxt varTysOrig\n  isDataFamily\n  = do varTysExp <- mapM expandSyn varTysOrig\n       let remainingLength :: Int\n           remainingLength = length varTysOrig - arityInt jc\n           droppedTysExp :: [Type]\n           droppedTysExp = drop remainingLength varTysExp\n           droppedStarKindStati :: [StarKindStatus]\n           droppedStarKindStati = map canRealizeKindStar droppedTysExp\n       when (remainingLength < 0 || elem NotKindStar droppedStarKindStati)\n         $ derivingKindError jc tyConName\n       let droppedKindVarNames :: [Name]\n           droppedKindVarNames = catKindVarNames droppedStarKindStati\n           varTysExpSubst :: [Type]\n           varTysExpSubst\n             = map (substNamesWithKindStar droppedKindVarNames) varTysExp\n           remainingTysExpSubst, droppedTysExpSubst :: [Type]\n           (remainingTysExpSubst, droppedTysExpSubst)\n             = splitAt remainingLength varTysExpSubst\n           droppedTyVarNames :: [Name]\n           droppedTyVarNames = concatMap tyVarNamesOfType droppedTysExpSubst\n       unless (all hasKindStar droppedTysExpSubst) $\n         derivingKindError jc tyConName\n       let preds :: [Maybe Pred]\n           kvNames :: [[Name]]\n           kvNames' :: [Name]\n           (preds, kvNames)\n             = unzip $ map (deriveConstraint jc) remainingTysExpSubst\n           kvNames' = concat kvNames\n           remainingTysExpSubst' :: [Type]\n           remainingTysExpSubst'\n             = map (substNamesWithKindStar kvNames') remainingTysExpSubst\n           remainingTysOrigSubst :: [Type]\n           remainingTysOrigSubst\n             = map\n                 (substNamesWithKindStar (droppedKindVarNames `union` kvNames'))\n                 $ take remainingLength varTysOrig\n           remainingTysOrigSubst' :: [Type]\n           remainingTysOrigSubst'\n             = if isDataFamily then remainingTysOrigSubst else\n                 map unSigT remainingTysOrigSubst\n           instanceCxt :: Cxt\n           instanceCxt = catMaybes preds\n           instanceType :: Type\n           instanceType\n             = AppT (ConT $ jsonClassName jc) $\n                 applyTyCon tyConName remainingTysOrigSubst'\n       when (any (`predMentionsName` droppedTyVarNames) dataCxt) $\n         datatypeContextError tyConName instanceType\n       unless (canEtaReduce remainingTysExpSubst' droppedTysExpSubst) $\n         etaReductionError instanceType\n       return (instanceCxt, instanceType)"],"instances":[],"language":{"extensions":["BangPatterns","FlexibleInstances","NamedFieldPuns","NoImplicitPrelude","UndecidableInstances","TemplateHaskellQuotes","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards","TemplateHaskell"],"isInstance":false}}