{"sliceID":1648177423474526705,"uses":[{"reference":{"otherSlice":8896971230885589368},"usedName":{"constructorName":{"identifier":"ResponseStream"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":8896971230885589368},"usedName":{"constructorName":{"identifier":"ResponseFile"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"System.IO"},"usedName":{"valueName":{"identifier":"withBinaryFile"}},"qualification":"IO"},{"reference":{"builtinModule":"GHC.IO.IOMode"},"usedName":{"constructorName":{"identifier":"ReadMode"},"constructorTypeName":{"identifier":"IOMode"}},"qualification":"IO"},{"reference":{"builtinModule":"GHC.IO.Handle"},"usedName":{"valueName":{"identifier":"hSeek"}},"qualification":"IO"},{"reference":{"builtinModule":"GHC.IO.Device"},"usedName":{"constructorName":{"identifier":"AbsoluteSeek"},"constructorTypeName":{"identifier":"SeekMode"}},"qualification":"IO"},{"reference":{"otherSlice":8174925800893531719},"usedName":{"valueName":{"identifier":"filePartOffset"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"<="}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":6032818157466347107},"usedName":{"valueName":{"identifier":"hGetSome"}},"qualification":"B"},{"reference":{"otherSlice":2339530253348411513},"usedName":{"valueName":{"identifier":"defaultChunkSize"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"unless"}},"qualification":null},{"reference":{"otherSlice":7202692338078551997},"usedName":{"valueName":{"identifier":"null"}},"qualification":"B"},{"reference":{"otherSlice":380767506459821795},"usedName":{"valueName":{"identifier":"take"}},"qualification":"B"},{"reference":{"otherSlice":7741660197025477614},"usedName":{"valueName":{"identifier":"fromByteString"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null},{"reference":{"otherSlice":7235567377809295464},"usedName":{"valueName":{"identifier":"length"}},"qualification":"B"},{"reference":{"builtinModule":"GHC.Real"},"usedName":{"valueName":{"identifier":"fromIntegral"}},"qualification":null},{"reference":{"otherSlice":8174925800893531719},"usedName":{"valueName":{"identifier":"filePartByteCount"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"Data.Function"},"usedName":{"valueName":{"identifier":"fix"}},"qualification":null},{"reference":{"otherSlice":8896971230885589368},"usedName":{"constructorName":{"identifier":"ResponseBuilder"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"otherSlice":8896971230885589368},"usedName":{"constructorName":{"identifier":"ResponseRaw"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"otherSlice":8896971230885589368},"usedName":{"typeName":{"identifier":"Response"}},"qualification":null},{"reference":{"otherSlice":4798754932090144467},"usedName":{"typeName":{"identifier":"Status"}},"qualification":"H"},{"reference":{"otherSlice":1840970391973419978},"usedName":{"typeName":{"identifier":"ResponseHeaders"}},"qualification":"H"},{"reference":{"otherSlice":3889333660260826472},"usedName":{"typeName":{"identifier":"StreamingBody"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null}],"fragment":["responseToStream ::\n                 Response ->\n                   (H.Status, H.ResponseHeaders, (StreamingBody -> IO a) -> IO a)","responseToStream (ResponseStream s h b) = (s, h, ($ b))\nresponseToStream (ResponseFile s h fp (Just part))\n  = (s, h,\n     \\ withBody ->\n       IO.withBinaryFile fp IO.ReadMode $\n         \\ handle ->\n           withBody $\n             \\ sendChunk _flush ->\n               do IO.hSeek handle IO.AbsoluteSeek $ filePartOffset part\n                  let loop remaining | remaining <= 0 = return ()\n                      loop remaining\n                        = do bs <- B.hGetSome handle defaultChunkSize\n                             unless (B.null bs) $\n                               do let x = B.take remaining bs\n                                  sendChunk $ fromByteString x\n                                  loop $ remaining - B.length x\n                  loop $ fromIntegral $ filePartByteCount part)\nresponseToStream (ResponseFile s h fp Nothing)\n  = (s, h,\n     \\ withBody ->\n       IO.withBinaryFile fp IO.ReadMode $\n         \\ handle ->\n           withBody $\n             \\ sendChunk _flush ->\n               fix $\n                 \\ loop ->\n                   do bs <- B.hGetSome handle defaultChunkSize\n                      unless (B.null bs) $\n                        do sendChunk $ fromByteString bs\n                           loop)\nresponseToStream (ResponseBuilder s h b)\n  = (s, h,\n     \\ withBody -> withBody $ \\ sendChunk _flush -> sendChunk b)\nresponseToStream (ResponseRaw _ res) = responseToStream res"],"instances":[],"language":{"extensions":["Rank2Types","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}