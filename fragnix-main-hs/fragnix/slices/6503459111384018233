{"sliceID":6503459111384018233,"uses":[{"reference":{"otherSlice":9025559142516147699},"usedName":{"valueName":{"identifier":"requestBodyLength"}},"qualification":null},{"reference":{"otherSlice":3677598914068400535},"usedName":{"constructorName":{"identifier":"KnownLength"},"constructorTypeName":{"identifier":"RequestBodyLength"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":">"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":9025559142516147699},"usedName":{"valueName":{"identifier":"requestBody"}},"qualification":null},{"reference":{"builtinModule":"GHC.IO"},"usedName":{"valueName":{"identifier":"throwIO"}},"qualification":null},{"reference":{"otherSlice":185453808187972502},"usedName":{"constructorName":{"identifier":"RequestSizeException"},"constructorTypeName":{"identifier":"RequestSizeException"}},"qualification":null},{"reference":{"otherSlice":3677598914068400535},"usedName":{"constructorName":{"identifier":"ChunkedBody"},"constructorTypeName":{"identifier":"RequestBodyLength"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"newIORef"}},"qualification":null},{"reference":{"builtinModule":"Data.IORef"},"usedName":{"valueName":{"identifier":"atomicModifyIORef'"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"+"}},"qualification":null},{"reference":{"builtinModule":"GHC.Real"},"usedName":{"valueName":{"identifier":"fromIntegral"}},"qualification":null},{"reference":{"otherSlice":7235567377809295464},"usedName":{"valueName":{"identifier":"length"}},"qualification":"S"},{"reference":{"builtinModule":"GHC.Word"},"usedName":{"typeName":{"identifier":"Word64"}},"qualification":null},{"reference":{"otherSlice":9025559142516147699},"usedName":{"typeName":{"identifier":"Request"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null}],"fragment":["requestSizeCheck :: Word64 -> Request -> IO Request","requestSizeCheck maxSize req\n  = case requestBodyLength req of\n        KnownLength len -> if len > maxSize then\n                             return $ req{requestBody = throwIO (RequestSizeException maxSize)}\n                             else return req\n        ChunkedBody -> do currentSize <- newIORef 0\n                          return $\n                            req{requestBody =\n                                  do bs <- requestBody req\n                                     total <- atomicModifyIORef' currentSize $\n                                                \\ sz ->\n                                                  let nextSize = sz + fromIntegral (S.length bs) in\n                                                    (nextSize, nextSize)\n                                     if total > maxSize then throwIO (RequestSizeException maxSize)\n                                       else return bs}"],"instances":[],"language":{"extensions":["OverloadedStrings","DeriveDataTypeable","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}