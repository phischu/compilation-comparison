{"sliceID":8148294637163468482,"uses":[{"reference":{"builtinModule":"GHC.IO"},"usedName":{"valueName":{"identifier":"mask_"}},"qualification":"E"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"Data.IORef"},"usedName":{"valueName":{"identifier":"atomicModifyIORef"}},"qualification":"I"},{"reference":{"otherSlice":8140350868394868031},"usedName":{"constructorName":{"identifier":"ReleaseMap"},"constructorTypeName":{"identifier":"ReleaseMap"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"builtinModule":"GHC.Enum"},"usedName":{"valueName":{"identifier":"minBound"}},"qualification":null},{"reference":{"otherSlice":8140350868394868031},"usedName":{"constructorName":{"identifier":"ReleaseMapClosed"},"constructorTypeName":{"identifier":"ReleaseMap"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Exception"},"usedName":{"valueName":{"identifier":"throw"}},"qualification":null},{"reference":{"otherSlice":6650791764623951010},"usedName":{"constructorName":{"identifier":"InvalidAccess"},"constructorTypeName":{"identifier":"InvalidAccess"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"mapM_"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":">>"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":8718272058432278351},"usedName":{"valueName":{"identifier":"elems"}},"qualification":"IntMap"},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"typeName":{"identifier":"Either"}},"qualification":null},{"reference":{"builtinModule":"GHC.Exception"},"usedName":{"typeName":{"identifier":"SomeException"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"try"}},"qualification":"E"},{"reference":{"otherSlice":6577957584704791200},"usedName":{"typeName":{"identifier":"ReleaseType"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"typeName":{"identifier":"IORef"}},"qualification":"I"},{"reference":{"otherSlice":8140350868394868031},"usedName":{"typeName":{"identifier":"ReleaseMap"}},"qualification":null}],"fragment":["stateCleanup :: ReleaseType -> I.IORef ReleaseMap -> IO ()","stateCleanup rtype istate\n  = E.mask_ $\n      do mm <- I.atomicModifyIORef istate $\n                 \\ rm ->\n                   case rm of\n                       ReleaseMap nk rf m -> let rf' = rf - 1 in\n                                               if rf' == minBound then (ReleaseMapClosed, Just m)\n                                                 else (ReleaseMap nk rf' m, Nothing)\n                       ReleaseMapClosed -> throw $ InvalidAccess \"stateCleanup\"\n         case mm of\n             Just m -> mapM_ (\\ x -> try (x rtype) >> return ()) $\n                         IntMap.elems m\n             Nothing -> return ()\n  where try :: IO a -> IO (Either SomeException a)\n        try = E.try"],"instances":[],"language":{"extensions":["DeriveDataTypeable","FlexibleInstances","FlexibleContexts","MultiParamTypeClasses","TypeFamilies","UndecidableInstances","RankNTypes","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}