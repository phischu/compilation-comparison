{"sliceID":9202009814239191684,"uses":[{"reference":{"otherSlice":8434830524291201891},"usedName":{"valueName":{"identifier":"control"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"GHC.IO"},"usedName":{"valueName":{"identifier":"mask"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"newIORef"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"otherSlice":258623574683819691},"usedName":{"valueName":{"identifier":"liftBase"}},"qualification":null},{"reference":{"builtinModule":"GHC.IO"},"usedName":{"valueName":{"identifier":"mask_"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"writeIORef"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"False"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.MVar"},"usedName":{"valueName":{"identifier":"putMVar"}},"qualification":"MVar"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"GHC.MVar"},"usedName":{"valueName":{"identifier":"takeMVar"}},"qualification":"MVar"},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"onException"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"readIORef"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"when"}},"qualification":null},{"reference":{"otherSlice":2946060544503603071},"usedName":{"typeName":{"identifier":"MonadBaseControl"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"builtinModule":"GHC.MVar"},"usedName":{"typeName":{"identifier":"MVar"}},"qualification":null}],"fragment":["modifyMVar ::\n             (MonadBaseControl IO m) => MVar a -> (a -> m (a, b)) -> m b","modifyMVar mv f\n  = control $\n      \\ runInIO ->\n        mask $\n          \\ restore ->\n            do aborted <- newIORef True\n               let f' x\n                     = do (x', a) <- f x\n                          liftBase $\n                            mask_ $\n                              do writeIORef aborted False\n                                 MVar.putMVar mv x'\n                          return a\n               x <- MVar.takeMVar mv\n               stM <- restore (runInIO (f' x)) `onException` MVar.putMVar mv x\n               abort <- readIORef aborted\n               when abort $ MVar.putMVar mv x\n               return stM"],"instances":[],"language":{"extensions":["NoImplicitPrelude","FlexibleContexts","TupleSections","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}