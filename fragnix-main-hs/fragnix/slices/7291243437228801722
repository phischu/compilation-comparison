{"sliceID":7291243437228801722,"uses":[{"reference":{"builtinModule":"GHC.IO"},"usedName":{"valueName":{"identifier":"mask_"}},"qualification":"E"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"Data.IORef"},"usedName":{"valueName":{"identifier":"atomicModifyIORef"}},"qualification":"I"},{"reference":{"otherSlice":7553344102295019907},"usedName":{"constructorName":{"identifier":"ReleaseMap"},"constructorTypeName":{"identifier":"ReleaseMap"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"builtinModule":"GHC.Enum"},"usedName":{"valueName":{"identifier":"minBound"}},"qualification":null},{"reference":{"otherSlice":7553344102295019907},"usedName":{"constructorName":{"identifier":"ReleaseMapClosed"},"constructorTypeName":{"identifier":"ReleaseMap"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Exception"},"usedName":{"valueName":{"identifier":"throw"}},"qualification":null},{"reference":{"otherSlice":7764092131534589755},"usedName":{"constructorName":{"identifier":"InvalidAccess"},"constructorTypeName":{"identifier":"InvalidAccess"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"mapM_"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":">>"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":8944651646915222115},"usedName":{"valueName":{"identifier":"elems"}},"qualification":"IntMap"},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"typeName":{"identifier":"Either"}},"qualification":null},{"reference":{"builtinModule":"GHC.Exception"},"usedName":{"typeName":{"identifier":"SomeException"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"try"}},"qualification":"E"},{"reference":{"otherSlice":220949478536803346},"usedName":{"typeName":{"identifier":"ReleaseType"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"typeName":{"identifier":"IORef"}},"qualification":"I"},{"reference":{"otherSlice":7553344102295019907},"usedName":{"typeName":{"identifier":"ReleaseMap"}},"qualification":null}],"fragment":["stateCleanup :: ReleaseType -> I.IORef ReleaseMap -> IO ()","stateCleanup rtype istate\n  = E.mask_ $\n      do mm <- I.atomicModifyIORef istate $\n                 \\ rm ->\n                   case rm of\n                       ReleaseMap nk rf m -> let rf' = rf - 1 in\n                                               if rf' == minBound then (ReleaseMapClosed, Just m)\n                                                 else (ReleaseMap nk rf' m, Nothing)\n                       ReleaseMapClosed -> throw $ InvalidAccess \"stateCleanup\"\n         case mm of\n             Just m -> mapM_ (\\ x -> try (x rtype) >> return ()) $\n                         IntMap.elems m\n             Nothing -> return ()\n  where try :: IO a -> IO (Either SomeException a)\n        try = E.try"],"instances":[],"language":{"extensions":["DeriveDataTypeable","FlexibleInstances","FlexibleContexts","MultiParamTypeClasses","TypeFamilies","UndecidableInstances","RankNTypes","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}