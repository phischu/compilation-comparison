{"sliceID":6844098294768314606,"uses":[{"reference":{"otherSlice":5933404239215446629},"usedName":{"constructorName":{"identifier":"ServerSettingsUnix"},"constructorTypeName":{"identifier":"ServerSettingsUnix"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"bracket"}},"qualification":"E"},{"reference":{"otherSlice":8844786871438269296},"usedName":{"valueName":{"identifier":"bindPath"}},"qualification":null},{"reference":{"otherSlice":1736940889399081958},"usedName":{"valueName":{"identifier":"sClose"}},"qualification":"NS"},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"forever"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"bracketOnError"}},"qualification":"E"},{"reference":{"otherSlice":7220496097278531713},"usedName":{"valueName":{"identifier":"acceptSafe"}},"qualification":null},{"reference":{"otherSlice":759241400355170078},"usedName":{"constructorName":{"identifier":"AppDataUnix"},"constructorTypeName":{"identifier":"AppDataUnix"}},"qualification":null},{"reference":{"otherSlice":759241400355170078},"usedName":{"valueName":{"identifier":"appReadUnix"}},"qualification":null},{"reference":{"otherSlice":2649696255758103766},"usedName":{"valueName":{"identifier":"safeRecv"}},"qualification":null},{"reference":{"otherSlice":759241400355170078},"usedName":{"valueName":{"identifier":"appWriteUnix"}},"qualification":null},{"reference":{"otherSlice":5966210289915665533},"usedName":{"valueName":{"identifier":"sendAll"}},"qualification":null},{"reference":{"builtinModule":"GHC.IO"},"usedName":{"valueName":{"identifier":"mask"}},"qualification":"E"},{"reference":{"builtinModule":"GHC.Conc.Sync"},"usedName":{"valueName":{"identifier":"forkIO"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"finally"}},"qualification":"E"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":5933404239215446629},"usedName":{"typeName":{"identifier":"ServerSettingsUnix"}},"qualification":null},{"reference":{"otherSlice":759241400355170078},"usedName":{"typeName":{"identifier":"AppDataUnix"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null}],"fragment":["runUnixServer ::\n              ServerSettingsUnix -> (AppDataUnix -> IO ()) -> IO a","runUnixServer (ServerSettingsUnix path afterBind) app\n  = E.bracket (bindPath path) NS.sClose\n      (\\ socket ->\n         do afterBind socket\n            forever $ serve socket)\n  where serve lsocket\n          = E.bracketOnError (acceptSafe lsocket)\n              (\\ (socket, _) -> NS.sClose socket)\n              $\n              \\ (socket, _) ->\n                do let ad\n                         = AppDataUnix{appReadUnix = safeRecv socket 4096,\n                                       appWriteUnix = sendAll socket}\n                   _ <- E.mask $\n                          \\ restore -> forkIO $ restore (app ad) `E.finally` NS.sClose socket\n                   return ()"],"instances":[],"language":{"extensions":["ScopedTypeVariables","BangPatterns","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}