{"sliceID":463669466912070098,"uses":[{"reference":{"otherSlice":2186011155846212713},"usedName":{"constructorName":{"identifier":"Stream"},"constructorTypeName":{"identifier":"Stream"}},"qualification":null},{"reference":{"otherSlice":4110134548223733529},"usedName":{"valueName":{"identifier":"runText"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":9185008376510166860},"usedName":{"valueName":{"identifier":"upperBound"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"+"}},"qualification":null},{"reference":{"otherSlice":5202209142239390005},"usedName":{"valueName":{"identifier":"new"}},"qualification":"A"},{"reference":{"otherSlice":899429663293461015},"usedName":{"constructorName":{"identifier":"Done"},"constructorTypeName":{"identifier":"Step"}},"qualification":null},{"reference":{"otherSlice":899429663293461015},"usedName":{"constructorName":{"identifier":"Skip"},"constructorTypeName":{"identifier":"Step"}},"qualification":null},{"reference":{"otherSlice":899429663293461015},"usedName":{"constructorName":{"identifier":"Yield"},"constructorTypeName":{"identifier":"Step"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"<"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"otherSlice":6830589594641922584},"usedName":{"valueName":{"identifier":"unsafeWrite"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"*"}},"qualification":null},{"reference":{"otherSlice":7788427119660368239},"usedName":{"valueName":{"identifier":"copyM"}},"qualification":"A"},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null},{"reference":{"otherSlice":2186011155846212713},"usedName":{"typeName":{"identifier":"Stream"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Char"}},"qualification":null},{"reference":{"otherSlice":2241541392207318616},"usedName":{"typeName":{"identifier":"Text"}},"qualification":null}],"fragment":["unstream :: Stream Char -> Text","unstream (Stream next0 s0 len)\n  = runText $\n      \\ done ->\n        do let mlen = upperBound 4 len + 1\n           arr0 <- A.new mlen\n           let outer !arr !maxi = encode\n                 where encode !si !di\n                         = case next0 si of\n                               Done -> done arr di\n                               Skip si' -> encode si' di\n                               Yield c si' | maxi < di + 1 -> realloc si di\n                                           | otherwise ->\n                                             do n <- unsafeWrite arr di c\n                                                encode si' (di + n)\n                       \n                       {-# NOINLINE realloc #-}\n                       realloc !si !di\n                         = do let newlen = (maxi + 1) * 2\n                              arr' <- A.new newlen\n                              A.copyM arr' 0 arr 0 di\n                              outer arr' (newlen - 1) si di\n           outer arr0 (mlen - 1) s0 0"],"instances":[],"language":{"extensions":["BangPatterns","MagicHash","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}