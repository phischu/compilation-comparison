{"sliceID":6516727800839376480,"uses":[{"reference":{"otherSlice":9158300280228540639},"usedName":{"typeName":{"identifier":"LoggerSet"}},"qualification":null},{"reference":{"otherSlice":321526138142310486},"usedName":{"typeName":{"identifier":"FileLogSpec"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"typeName":{"identifier":"IORef"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Int"}},"qualification":null},{"reference":{"builtinModule":"GHC.MVar"},"usedName":{"typeName":{"identifier":"MVar"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"bracket"}},"qualification":null},{"reference":{"builtinModule":"GHC.MVar"},"usedName":{"valueName":{"identifier":"tryTakeMVar"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"GHC.MVar"},"usedName":{"valueName":{"identifier":"putMVar"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"writeIORef"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":">"}},"qualification":null},{"reference":{"otherSlice":1523995142736160600},"usedName":{"valueName":{"identifier":"rotate"}},"qualification":null},{"reference":{"otherSlice":2926462799869765440},"usedName":{"valueName":{"identifier":"renewLoggerSet"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null},{"reference":{"otherSlice":321526138142310486},"usedName":{"valueName":{"identifier":"log_file"}},"qualification":null},{"reference":{"otherSlice":321526138142310486},"usedName":{"valueName":{"identifier":"log_file_size"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"handle"}},"qualification":null},{"reference":{"builtinModule":"GHC.Exception"},"usedName":{"constructorName":{"identifier":"SomeException"},"constructorTypeName":{"identifier":"SomeException"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"."}},"qualification":null},{"reference":{"builtinModule":"GHC.Real"},"usedName":{"valueName":{"identifier":"fromIntegral"}},"qualification":null},{"reference":{"builtinModule":"Data.Functor"},"usedName":{"valueName":{"operator":"<$>"}},"qualification":null},{"reference":{"otherSlice":4137069847161050124},"usedName":{"valueName":{"identifier":"getFileSize"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"identifier":"fromInteger"}},"qualification":null},{"reference":{"builtinModule":"GHC.Real"},"usedName":{"valueName":{"identifier":"div"}},"qualification":null}],"fragment":["tryRotate ::\n          LoggerSet -> FileLogSpec -> IORef Int -> MVar () -> IO ()","tryRotate lgrset spec ref mvar = bracket lock unlock rotateFiles\n  where lock = tryTakeMVar mvar\n        unlock Nothing = return ()\n        unlock _ = putMVar mvar ()\n        rotateFiles Nothing = return ()\n        rotateFiles _\n          = do msiz <- getSize\n               case msiz of\n                   Nothing -> writeIORef ref 1000000\n                   Just siz | siz > limit ->\n                              do rotate spec\n                                 renewLoggerSet lgrset\n                                 writeIORef ref $ estimate limit\n                            | otherwise -> writeIORef ref $ estimate (limit - siz)\n        file = log_file spec\n        limit = log_file_size spec\n        getSize\n          = handle (\\ (SomeException _) -> return Nothing) $\n              Just . fromIntegral <$> getFileSize file\n        estimate x = fromInteger (x `div` 200)"],"instances":[],"language":{"extensions":["OverloadedStrings","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}