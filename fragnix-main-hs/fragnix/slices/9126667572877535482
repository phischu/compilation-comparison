{"sliceID":9126667572877535482,"uses":[{"reference":{"otherSlice":5677364752125141640},"usedName":{"constructorName":{"identifier":"RspFile"},"constructorTypeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"otherSlice":5399596082623183917},"usedName":{"valueName":{"identifier":"fileRange"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"constructorName":{"identifier":"Left"},"constructorTypeName":{"identifier":"Either"}},"qualification":null},{"reference":{"otherSlice":5677364752125141640},"usedName":{"constructorName":{"identifier":"RspBuilder"},"constructorTypeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"constructorName":{"identifier":"Right"},"constructorTypeName":{"identifier":"Either"}},"qualification":null},{"reference":{"otherSlice":4866366613412677324},"usedName":{"valueName":{"identifier":"composeHeader"}},"qualification":null},{"reference":{"otherSlice":4881703223122348873},"usedName":{"valueName":{"identifier":"connSendFile"}},"qualification":null},{"reference":{"otherSlice":3770546537661119877},"usedName":{"valueName":{"identifier":"addAcceptRanges"}},"qualification":null},{"reference":{"otherSlice":5156291329837017844},"usedName":{"valueName":{"identifier":"status404"}},"qualification":"H"},{"reference":{"otherSlice":60995509145371844},"usedName":{"valueName":{"identifier":"replaceHeader"}},"qualification":null},{"reference":{"otherSlice":7956704034684259635},"usedName":{"valueName":{"identifier":"hContentType"}},"qualification":"H"},{"reference":{"otherSlice":5870116409610916390},"usedName":{"valueName":{"identifier":"fromByteString"}},"qualification":null},{"reference":{"otherSlice":3209095121004806015},"usedName":{"valueName":{"identifier":"composeHeaderBuilder"}},"qualification":null},{"reference":{"builtinModule":"Data.Monoid"},"usedName":{"valueName":{"operator":"<>"}},"qualification":null},{"reference":{"otherSlice":600845713027802444},"usedName":{"valueName":{"identifier":"chunkedTransferEncoding"}},"qualification":null},{"reference":{"otherSlice":5807637848516632645},"usedName":{"valueName":{"identifier":"chunkedTransferTerminator"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"otherSlice":4881703223122348873},"usedName":{"valueName":{"identifier":"connWriteBuffer"}},"qualification":null},{"reference":{"otherSlice":4881703223122348873},"usedName":{"valueName":{"identifier":"connBufferSize"}},"qualification":null},{"reference":{"otherSlice":2409637922026160557},"usedName":{"valueName":{"identifier":"toBufIOWith"}},"qualification":null},{"reference":{"otherSlice":4881703223122348873},"usedName":{"valueName":{"identifier":"connSendAll"}},"qualification":null},{"reference":{"otherSlice":5677364752125141640},"usedName":{"constructorName":{"identifier":"RspStream"},"constructorTypeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"otherSlice":3864479888619181519},"usedName":{"valueName":{"identifier":"newBlazeRecv"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":145791877993654080},"usedName":{"valueName":{"identifier":"reuseBufferStrategy"}},"qualification":null},{"reference":{"otherSlice":4682357061605673879},"usedName":{"valueName":{"identifier":"toBlazeBuffer"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"unless"}},"qualification":null},{"reference":{"otherSlice":675696118971413715},"usedName":{"valueName":{"identifier":"null"}},"qualification":"S"},{"reference":{"otherSlice":5612583919998684534},"usedName":{"valueName":{"identifier":"connSink"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"."}},"qualification":null},{"reference":{"otherSlice":1251236928786591586},"usedName":{"valueName":{"identifier":"flush"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"when"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"valueName":{"identifier":"maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":5677364752125141640},"usedName":{"constructorName":{"identifier":"RspRaw"},"constructorTypeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":">>"}},"qualification":null},{"reference":{"otherSlice":4881703223122348873},"usedName":{"typeName":{"identifier":"Connection"}},"qualification":null},{"reference":{"otherSlice":9081086120732775883},"usedName":{"typeName":{"identifier":"HttpVersion"}},"qualification":"H"},{"reference":{"otherSlice":5548762664127723913},"usedName":{"typeName":{"identifier":"Status"}},"qualification":"H"},{"reference":{"otherSlice":8689147996023585074},"usedName":{"typeName":{"identifier":"ResponseHeaders"}},"qualification":"H"},{"reference":{"otherSlice":5677364752125141640},"usedName":{"typeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null}],"fragment":["sendRsp ::\n        Connection ->\n          H.HttpVersion -> H.Status -> H.ResponseHeaders -> Rsp -> IO ()","sendRsp conn ver s0 hs0 (RspFile path mPart mRange hook)\n  = do ex <- fileRange s0 hs path mPart mRange\n       case ex of\n           Left _ex -> sendRsp conn ver s2 hs2 (RspBuilder body True)\n           Right (s, hs1, beg, len) -> do lheader <- composeHeader ver s hs1\n                                          connSendFile conn path beg len hook [lheader]\n  where hs = addAcceptRanges hs0\n        s2 = H.status404\n        hs2 = replaceHeader H.hContentType \"text/plain; charset=utf-8\" hs0\n        body = fromByteString \"File not found\"\nsendRsp conn ver s hs (RspBuilder body needsChunked)\n  = do header <- composeHeaderBuilder ver s hs needsChunked\n       let hdrBdy\n             | needsChunked =\n               header <> chunkedTransferEncoding body <> chunkedTransferTerminator\n             | otherwise = header <> body\n           buffer = connWriteBuffer conn\n           size = connBufferSize conn\n       toBufIOWith buffer size (connSendAll conn) hdrBdy\nsendRsp conn ver s hs (RspStream withBodyFlush needsChunked th)\n  = do header <- composeHeaderBuilder ver s hs needsChunked\n       (recv, finish) <- newBlazeRecv $\n                           reuseBufferStrategy $\n                             toBlazeBuffer (connWriteBuffer conn) (connBufferSize conn)\n       let addChunk builder\n             = do popper <- recv builder\n                  let loop\n                        = do bs <- popper\n                             unless (S.null bs) $\n                               do connSink conn th bs\n                                  loop\n                  loop\n           addChunk'\n             | needsChunked = addChunk . chunkedTransferEncoding\n             | otherwise = addChunk\n       addChunk header\n       withBodyFlush addChunk' (addChunk' flush)\n       when needsChunked $ addChunk chunkedTransferTerminator\n       mbs <- finish\n       maybe (return ()) (connSink conn th) mbs\nsendRsp conn _ _ _ (RspRaw withApp src tickle) = withApp recv send\n  where recv\n          = do bs <- src\n               unless (S.null bs) tickle\n               return bs\n        send bs = connSendAll conn bs >> tickle"],"instances":[],"language":{"extensions":["OverloadedStrings","ScopedTypeVariables","TupleSections","RankNTypes","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}