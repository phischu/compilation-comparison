{"sliceID":3657869686664526164,"uses":[{"reference":{"otherSlice":3404358292982908639},"usedName":{"constructorName":{"identifier":"FrameSettings"},"constructorTypeName":{"identifier":"FrameTypeId"}},"qualification":null},{"reference":{"otherSlice":1285600184885925655},"usedName":{"constructorName":{"identifier":"FrameHeader"},"constructorTypeName":{"identifier":"FrameHeader"}},"qualification":null},{"reference":{"otherSlice":1285600184885925655},"usedName":{"valueName":{"identifier":"flags"}},"qualification":null},{"reference":{"otherSlice":4041040564016882290},"usedName":{"constructorName":{"identifier":"Context"},"constructorTypeName":{"identifier":"Context"}},"qualification":null},{"reference":{"otherSlice":4041040564016882290},"usedName":{"valueName":{"identifier":"http2settings"}},"qualification":null},{"reference":{"otherSlice":4041040564016882290},"usedName":{"valueName":{"identifier":"controlQ"}},"qualification":null},{"reference":{"otherSlice":4041040564016882290},"usedName":{"valueName":{"identifier":"firstSettings"}},"qualification":null},{"reference":{"otherSlice":4041040564016882290},"usedName":{"valueName":{"identifier":"streamTable"}},"qualification":null},{"reference":{"otherSlice":8661256068812973938},"usedName":{"constructorName":{"identifier":"SettingsFrame"},"constructorTypeName":{"identifier":"FramePayload"}},"qualification":null},{"reference":{"otherSlice":8820382256421280623},"usedName":{"valueName":{"identifier":"guardIt"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":4860525681423495258},"usedName":{"valueName":{"identifier":"decodeSettingsFrame"}},"qualification":null},{"reference":{"otherSlice":8215602778416885278},"usedName":{"valueName":{"identifier":"checkSettingsList"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.IO"},"usedName":{"valueName":{"identifier":"throwIO"}},"qualification":"E"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"unless"}},"qualification":null},{"reference":{"otherSlice":5177628619844568599},"usedName":{"valueName":{"identifier":"testAck"}},"qualification":null},{"reference":{"otherSlice":6400076285833186274},"usedName":{"valueName":{"identifier":"initialWindowSize"}},"qualification":null},{"reference":{"builtinModule":"Data.Functor"},"usedName":{"valueName":{"operator":"<$>"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"readIORef"}},"qualification":null},{"reference":{"builtinModule":"Data.IORef"},"usedName":{"valueName":{"identifier":"modifyIORef'"}},"qualification":null},{"reference":{"otherSlice":8859459687575490091},"usedName":{"valueName":{"identifier":"updateSettings"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"when"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"/="}},"qualification":null},{"reference":{"otherSlice":7726762683122352393},"usedName":{"valueName":{"identifier":"updateAllStreamWindow"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"+"}},"qualification":null},{"reference":{"otherSlice":8441203602235846092},"usedName":{"valueName":{"identifier":"settingsFrame"}},"qualification":null},{"reference":{"otherSlice":527093756858213021},"usedName":{"valueName":{"identifier":"setAck"}},"qualification":null},{"reference":{"otherSlice":2096491001196216488},"usedName":{"constructorName":{"identifier":"CSettings"},"constructorTypeName":{"identifier":"Control"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"otherSlice":2096491001196216488},"usedName":{"constructorName":{"identifier":"CSettings0"},"constructorTypeName":{"identifier":"Control"}},"qualification":null},{"reference":{"otherSlice":2420002122713805542},"usedName":{"valueName":{"identifier":"initialFrame"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"writeIORef"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"otherSlice":2847764183293833005},"usedName":{"valueName":{"identifier":"enqueueControl"}},"qualification":null},{"reference":{"otherSlice":3404358292982908639},"usedName":{"constructorName":{"identifier":"FramePing"},"constructorTypeName":{"identifier":"FrameTypeId"}},"qualification":null},{"reference":{"otherSlice":6103616750240700031},"usedName":{"valueName":{"identifier":"pingFrame"}},"qualification":null},{"reference":{"otherSlice":2096491001196216488},"usedName":{"constructorName":{"identifier":"CFrame"},"constructorTypeName":{"identifier":"Control"}},"qualification":null},{"reference":{"otherSlice":3404358292982908639},"usedName":{"constructorName":{"identifier":"FrameGoAway"},"constructorTypeName":{"identifier":"FrameTypeId"}},"qualification":null},{"reference":{"otherSlice":2096491001196216488},"usedName":{"constructorName":{"identifier":"CFinish"},"constructorTypeName":{"identifier":"Control"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"False"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"otherSlice":3404358292982908639},"usedName":{"constructorName":{"identifier":"FrameWindowUpdate"},"constructorTypeName":{"identifier":"FrameTypeId"}},"qualification":null},{"reference":{"otherSlice":4041040564016882290},"usedName":{"valueName":{"identifier":"connectionWindow"}},"qualification":null},{"reference":{"otherSlice":8661256068812973938},"usedName":{"constructorName":{"identifier":"WindowUpdateFrame"},"constructorTypeName":{"identifier":"FramePayload"}},"qualification":null},{"reference":{"otherSlice":3063105540659126245},"usedName":{"valueName":{"identifier":"decodeWindowUpdateFrame"}},"qualification":null},{"reference":{"builtinModule":"GHC.Conc.Sync"},"usedName":{"valueName":{"identifier":"atomically"}},"qualification":null},{"reference":{"builtinModule":"GHC.Conc.Sync"},"usedName":{"valueName":{"identifier":"readTVar"}},"qualification":null},{"reference":{"otherSlice":14296064439636611},"usedName":{"valueName":{"identifier":"isWindowOverflow"}},"qualification":null},{"reference":{"otherSlice":3799123115806425041},"usedName":{"constructorName":{"identifier":"ConnectionError"},"constructorTypeName":{"identifier":"HTTP2Error"}},"qualification":null},{"reference":{"otherSlice":5005511013097534442},"usedName":{"constructorName":{"identifier":"FlowControlError"},"constructorTypeName":{"identifier":"ErrorCodeId"}},"qualification":null},{"reference":{"builtinModule":"GHC.Conc.Sync"},"usedName":{"valueName":{"identifier":"writeTVar"}},"qualification":null},{"reference":{"otherSlice":3404358292982908639},"usedName":{"typeName":{"identifier":"FrameTypeId"}},"qualification":null},{"reference":{"otherSlice":1285600184885925655},"usedName":{"typeName":{"identifier":"FrameHeader"}},"qualification":null},{"reference":{"otherSlice":4010822550476529195},"usedName":{"typeName":{"identifier":"ByteString"}},"qualification":null},{"reference":{"otherSlice":4041040564016882290},"usedName":{"typeName":{"identifier":"Context"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Bool"}},"qualification":null}],"fragment":["control ::\n        FrameTypeId -> FrameHeader -> ByteString -> Context -> IO Bool","control FrameSettings header@FrameHeader{flags} bs\n  Context{http2settings, controlQ, firstSettings, streamTable}\n  = do SettingsFrame alist <- guardIt $ decodeSettingsFrame header bs\n       case checkSettingsList alist of\n           Just x -> E.throwIO x\n           Nothing -> return ()\n       unless (testAck flags) $\n         do oldws <- initialWindowSize <$> readIORef http2settings\n            modifyIORef' http2settings $ \\ old -> updateSettings old alist\n            newws <- initialWindowSize <$> readIORef http2settings\n            let diff = newws - oldws\n            when (diff /= 0) $ updateAllStreamWindow (+ diff) streamTable\n            let !frame = settingsFrame setAck []\n            sent <- readIORef firstSettings\n            let !setframe\n                  | sent = CSettings frame alist\n                  | otherwise = CSettings0 initialFrame frame alist\n            unless sent $ writeIORef firstSettings True\n            enqueueControl controlQ setframe\n       return True\ncontrol FramePing FrameHeader{flags} bs Context{controlQ}\n  = if testAck flags then return True else\n      do let !frame = pingFrame bs\n         enqueueControl controlQ $ CFrame frame\n         return True\ncontrol FrameGoAway _ _ Context{controlQ}\n  = do enqueueControl controlQ CFinish\n       return False\ncontrol FrameWindowUpdate header bs Context{connectionWindow}\n  = do WindowUpdateFrame n <- guardIt $\n                                decodeWindowUpdateFrame header bs\n       !w <- (n +) <$> atomically (readTVar connectionWindow)\n       when (isWindowOverflow w) $\n         E.throwIO $\n           ConnectionError FlowControlError\n             \"control window should be less than 2^31\"\n       atomically $ writeTVar connectionWindow w\n       return True\ncontrol _ _ _ _ = return False"],"instances":[],"language":{"extensions":["OverloadedStrings","NamedFieldPuns","BangPatterns","PatternGuards","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll"],"isInstance":false}}