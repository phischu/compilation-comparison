{"sliceID":8297586936229350262,"uses":[{"reference":{"otherSlice":8072899159494863221},"usedName":{"valueName":{"identifier":"defaultHints"}},"qualification":"NS"},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrFlags"}},"qualification":"NS"},{"reference":{"otherSlice":7274990277951535068},"usedName":{"constructorName":{"identifier":"AI_PASSIVE"},"constructorTypeName":{"identifier":"AddrInfoFlag"}},"qualification":"NS"},{"reference":{"otherSlice":7274990277951535068},"usedName":{"constructorName":{"identifier":"AI_NUMERICSERV"},"constructorTypeName":{"identifier":"AddrInfoFlag"}},"qualification":"NS"},{"reference":{"otherSlice":7274990277951535068},"usedName":{"constructorName":{"identifier":"AI_NUMERICHOST"},"constructorTypeName":{"identifier":"AddrInfoFlag"}},"qualification":"NS"},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrSocketType"}},"qualification":"NS"},{"reference":{"otherSlice":9088266594394639967},"usedName":{"constructorName":{"identifier":"Host"},"constructorTypeName":{"identifier":"HostPreference"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"."}},"qualification":null},{"reference":{"builtinModule":"GHC.Show"},"usedName":{"valueName":{"identifier":"show"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":231875607056582677},"usedName":{"valueName":{"identifier":"getAddrInfo"}},"qualification":"NS"},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"filter"}},"qualification":null},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrFamily"}},"qualification":"NS"},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"/="}},"qualification":null},{"reference":{"otherSlice":4486329222352366024},"usedName":{"constructorName":{"identifier":"AF_INET6"},"constructorTypeName":{"identifier":"Family"}},"qualification":"NS"},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"otherSlice":9088266594394639967},"usedName":{"constructorName":{"identifier":"HostIPv4"},"constructorTypeName":{"identifier":"HostPreference"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"++"}},"qualification":null},{"reference":{"otherSlice":9088266594394639967},"usedName":{"constructorName":{"identifier":"HostIPv4Only"},"constructorTypeName":{"identifier":"HostPreference"}},"qualification":null},{"reference":{"otherSlice":9088266594394639967},"usedName":{"constructorName":{"identifier":"HostIPv6"},"constructorTypeName":{"identifier":"HostPreference"}},"qualification":null},{"reference":{"otherSlice":9088266594394639967},"usedName":{"constructorName":{"identifier":"HostIPv6Only"},"constructorTypeName":{"identifier":"HostPreference"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"catch"}},"qualification":"E"},{"reference":{"builtinModule":"GHC.IO.Exception"},"usedName":{"typeName":{"identifier":"IOException"}},"qualification":null},{"reference":{"builtinModule":"GHC.Err"},"usedName":{"valueName":{"identifier":"error"}},"qualification":null},{"reference":{"otherSlice":3163448590057951563},"usedName":{"constructorName":{"identifier":"Datagram"},"constructorTypeName":{"identifier":"SocketType"}},"qualification":"NS"},{"reference":{"otherSlice":1193574024344381829},"usedName":{"constructorName":{"identifier":"ReuseAddr"},"constructorTypeName":{"identifier":"SocketOption"}},"qualification":"NS"},{"reference":{"otherSlice":1193574024344381829},"usedName":{"constructorName":{"identifier":"NoDelay"},"constructorTypeName":{"identifier":"SocketOption"}},"qualification":"NS"},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"bracketOnError"}},"qualification":null},{"reference":{"otherSlice":5388047469248839065},"usedName":{"valueName":{"identifier":"socket"}},"qualification":"NS"},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrProtocol"}},"qualification":"NS"},{"reference":{"otherSlice":1736940889399081958},"usedName":{"valueName":{"identifier":"sClose"}},"qualification":"NS"},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"mapM_"}},"qualification":null},{"reference":{"otherSlice":5242549618965026866},"usedName":{"valueName":{"identifier":"setSocketOption"}},"qualification":"NS"},{"reference":{"otherSlice":2237209920055623949},"usedName":{"valueName":{"identifier":"bindSocket"}},"qualification":"NS"},{"reference":{"otherSlice":8548432960023453856},"usedName":{"valueName":{"identifier":"addrAddress"}},"qualification":"NS"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":3163448590057951563},"usedName":{"typeName":{"identifier":"SocketType"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Int"}},"qualification":null},{"reference":{"otherSlice":9088266594394639967},"usedName":{"typeName":{"identifier":"HostPreference"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":3934872489478287384},"usedName":{"typeName":{"identifier":"Socket"}},"qualification":null}],"fragment":["bindPortGen :: SocketType -> Int -> HostPreference -> IO Socket","bindPortGen sockettype p s\n  = do let hints\n             = NS.defaultHints{NS.addrFlags =\n                                 [NS.AI_PASSIVE, NS.AI_NUMERICSERV, NS.AI_NUMERICHOST],\n                               NS.addrSocketType = sockettype}\n           host\n             = case s of\n                   Host s' -> Just s'\n                   _ -> Nothing\n           port = Just . show $ p\n       addrs <- NS.getAddrInfo (Just hints) host port\n       let addrs4 = filter (\\ x -> NS.addrFamily x /= NS.AF_INET6) addrs\n           addrs6 = filter (\\ x -> NS.addrFamily x == NS.AF_INET6) addrs\n           addrs'\n             = case s of\n                   HostIPv4 -> addrs4 ++ addrs6\n                   HostIPv4Only -> addrs4\n                   HostIPv6 -> addrs6 ++ addrs4\n                   HostIPv6Only -> addrs6\n                   _ -> addrs\n           tryAddrs (addr1 : rest@(_ : _))\n             = E.catch (theBody addr1) (\\ (_ :: IOException) -> tryAddrs rest)\n           tryAddrs (addr1 : []) = theBody addr1\n           tryAddrs _ = error \"bindPort: addrs is empty\"\n           sockOpts\n             = case sockettype of\n                   NS.Datagram -> [(NS.ReuseAddr, 1)]\n                   _ -> [(NS.NoDelay, 1), (NS.ReuseAddr, 1)]\n           theBody addr\n             = bracketOnError\n                 (NS.socket (NS.addrFamily addr) (NS.addrSocketType addr)\n                    (NS.addrProtocol addr))\n                 NS.sClose\n                 (\\ sock ->\n                    do mapM_ (\\ (opt, v) -> NS.setSocketOption sock opt v) sockOpts\n                       NS.bindSocket sock (NS.addrAddress addr)\n                       return sock)\n       tryAddrs addrs'"],"instances":[],"language":{"extensions":["ScopedTypeVariables","BangPatterns","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}