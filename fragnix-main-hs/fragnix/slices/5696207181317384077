{"sliceID":5696207181317384077,"uses":[{"reference":{"otherSlice":9025559142516147699},"usedName":{"valueName":{"identifier":"requestBodyLength"}},"qualification":null},{"reference":{"otherSlice":1572734864160732866},"usedName":{"valueName":{"identifier":"contentLength"}},"qualification":null},{"reference":{"otherSlice":9025559142516147699},"usedName":{"valueName":{"identifier":"requestHeaders"}},"qualification":null},{"reference":{"otherSlice":3677598914068400535},"usedName":{"constructorName":{"identifier":"KnownLength"},"constructorTypeName":{"identifier":"RequestBodyLength"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"<="}},"qualification":null},{"reference":{"otherSlice":1781729464755261329},"usedName":{"valueName":{"identifier":"getRequestBody"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"null"}},"qualification":null},{"reference":{"otherSlice":4988001367788118396},"usedName":{"constructorName":{"identifier":"White"},"constructorTypeName":{"identifier":"Color"}},"qualification":null},{"reference":{"builtinModule":"Data.Monoid"},"usedName":{"valueName":{"operator":"<>"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"concatMap"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"valueName":{"identifier":"either"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"const"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"."}},"qualification":null},{"reference":{"otherSlice":8015666592098900910},"usedName":{"valueName":{"identifier":"decodeUtf8'"}},"qualification":null},{"reference":{"otherSlice":9025559142516147699},"usedName":{"valueName":{"identifier":"requestMethod"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"elem"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad.IO.Class"},"usedName":{"valueName":{"identifier":"liftIO"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"map"}},"qualification":null},{"reference":{"otherSlice":9025559142516147699},"usedName":{"valueName":{"identifier":"queryString"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"valueName":{"identifier":"fromMaybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"lookup"}},"qualification":null},{"reference":{"otherSlice":1770321871109794098},"usedName":{"valueName":{"identifier":"hAccept"}},"qualification":"H"},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"identifier":"not"}},"qualification":null},{"reference":{"otherSlice":3693489416482845935},"usedName":{"valueName":{"identifier":"pack"}},"qualification":null},{"reference":{"builtinModule":"GHC.Show"},"usedName":{"valueName":{"identifier":"show"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"otherSlice":3520656688728995171},"usedName":{"valueName":{"identifier":"getCurrentTime"}},"qualification":null},{"reference":{"otherSlice":8896971230885589368},"usedName":{"constructorName":{"identifier":"ResponseRaw"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"False"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"otherSlice":3996268843716188348},"usedName":{"valueName":{"identifier":"statusBS"}},"qualification":null},{"reference":{"otherSlice":2796997992732215611},"usedName":{"valueName":{"identifier":"msgBS"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"mconcat"}},"qualification":null},{"reference":{"otherSlice":2178822211885167332},"usedName":{"valueName":{"identifier":"toLogStr"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"++"}},"qualification":null},{"reference":{"otherSlice":9025559142516147699},"usedName":{"valueName":{"identifier":"rawPathInfo"}},"qualification":null},{"reference":{"otherSlice":1946275509729215482},"usedName":{"valueName":{"identifier":"diffUTCTime"}},"qualification":null},{"reference":{"otherSlice":5382744851172164193},"usedName":{"valueName":{"identifier":"getRequestBodyType"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"otherSlice":8674753700518513804},"usedName":{"valueName":{"identifier":"newIORef"}},"qualification":null},{"reference":{"otherSlice":3181616987806966080},"usedName":{"valueName":{"identifier":"atomicModifyIORef"}},"qualification":null},{"reference":{"otherSlice":7459617743278403755},"usedName":{"valueName":{"identifier":"empty"}},"qualification":"S8"},{"reference":{"otherSlice":5080450939825380007},"usedName":{"valueName":{"identifier":"sinkRequestBody"}},"qualification":null},{"reference":{"otherSlice":2775313906076224659},"usedName":{"valueName":{"identifier":"lbsBackEnd"}},"qualification":null},{"reference":{"otherSlice":4010822550476529195},"usedName":{"typeName":{"identifier":"ByteString"}},"qualification":"BS"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"typeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"otherSlice":3499026409408763122},"usedName":{"typeName":{"identifier":"Param"}},"qualification":null},{"reference":{"otherSlice":2753909998167551698},"usedName":{"typeName":{"identifier":"File"}},"qualification":null},{"reference":{"otherSlice":7233619382983855062},"usedName":{"typeName":{"identifier":"ByteString"}},"qualification":"LBS"},{"reference":{"otherSlice":5775771971139873167},"usedName":{"valueName":{"identifier":"fileName"}},"qualification":null},{"reference":{"otherSlice":1800534538030875171},"usedName":{"typeName":{"identifier":"Callback"}},"qualification":null},{"reference":{"otherSlice":4988001367788118396},"usedName":{"typeName":{"identifier":"Color"}},"qualification":null},{"reference":{"otherSlice":4688632796141833664},"usedName":{"typeName":{"identifier":"Middleware"}},"qualification":null}],"fragment":["detailedMiddleware' ::\n                    Callback ->\n                      (Color -> BS.ByteString -> [BS.ByteString]) ->\n                        (BS.ByteString -> [BS.ByteString]) ->\n                          (BS.ByteString -> BS.ByteString -> [BS.ByteString]) -> Middleware","detailedMiddleware' cb ansiColor ansiMethod ansiStatusCode app req\n  sendResponse\n  = do (req', body) <- case\n                         (requestBodyLength req, contentLength (requestHeaders req)) of\n                           (KnownLength len, _) | len <= 2048 -> getRequestBody req\n                           (_, Just len) | len <= 2048 -> getRequestBody req\n                           _ -> return (req, [])\n       let reqbodylog _\n             = if null body then [\"\"] else\n                 ansiColor White \"  Request Body: \" <> body <> [\"\\n\"]\n           reqbody\n             = concatMap (either (const [\"\"]) reqbodylog . decodeUtf8') body\n       postParams <- if requestMethod req `elem` [\"GET\", \"HEAD\"] then\n                       return [] else\n                       do postParams <- liftIO $ allPostParams body\n                          return $ collectPostParams postParams\n       let getParams = map emptyGetParam $ queryString req\n           accept = fromMaybe \"\" $ lookup H.hAccept $ requestHeaders req\n           params\n             = let par\n                     | not $ null postParams = [pack (show postParams)]\n                     | not $ null getParams = [pack (show getParams)]\n                     | otherwise = []\n                 in\n                 if null par then [\"\"] else\n                   ansiColor White \"  Params: \" <> par <> [\"\\n\"]\n       t0 <- getCurrentTime\n       app req' $\n         \\ rsp ->\n           do let isRaw\n                    = case rsp of\n                          ResponseRaw{} -> True\n                          _ -> False\n                  stCode = statusBS rsp\n                  stMsg = msgBS rsp\n              t1 <- getCurrentTime\n              cb $\n                mconcat $\n                  map toLogStr $\n                    ansiMethod (requestMethod req) ++\n                      [\" \", rawPathInfo req, \"\\n\"] ++\n                        params ++\n                          reqbody ++\n                            ansiColor White \"  Accept: \" ++\n                              [accept, \"\\n\"] ++\n                                if isRaw then [] else\n                                  ansiColor White \"  Status: \" ++\n                                    ansiStatusCode stCode (stCode <> \" \" <> stMsg) ++\n                                      [\" \", pack $ show $ diffUTCTime t1 t0, \"\\n\"]\n              sendResponse rsp\n  where allPostParams body\n          = case getRequestBodyType req of\n                Nothing -> return ([], [])\n                Just rbt -> do ichunks <- newIORef body\n                               let rbody\n                                     = atomicModifyIORef ichunks $\n                                         \\ chunks ->\n                                           case chunks of\n                                               [] -> ([], S8.empty)\n                                               x : y -> (y, x)\n                               sinkRequestBody lbsBackEnd rbt rbody\n        \n        emptyGetParam ::\n                      (BS.ByteString, Maybe BS.ByteString) ->\n                        (BS.ByteString, BS.ByteString)\n        emptyGetParam (k, Just v) = (k, v)\n        emptyGetParam (k, Nothing) = (k, \"\")\n        \n        collectPostParams :: ([Param], [File LBS.ByteString]) -> [Param]\n        collectPostParams (postParams, files)\n          = postParams ++ map (\\ (k, v) -> (k, \"FILE: \" <> fileName v)) files"],"instances":[],"language":{"extensions":["OverloadedStrings","RecordWildCards","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}