{"sliceID":1405564348820329699,"uses":[{"reference":{"otherSlice":7380852613632988749},"usedName":{"valueName":{"identifier":"getProtocolNumber"}},"qualification":null},{"reference":{"otherSlice":4360120424655547227},"usedName":{"valueName":{"identifier":"defaultHints"}},"qualification":null},{"reference":{"otherSlice":327701426414781642},"usedName":{"valueName":{"identifier":"addrFlags"}},"qualification":null},{"reference":{"otherSlice":5386083940265316368},"usedName":{"constructorName":{"identifier":"AI_ADDRCONFIG"},"constructorTypeName":{"identifier":"AddrInfoFlag"}},"qualification":null},{"reference":{"otherSlice":5386083940265316368},"usedName":{"constructorName":{"identifier":"AI_PASSIVE"},"constructorTypeName":{"identifier":"AddrInfoFlag"}},"qualification":null},{"reference":{"otherSlice":327701426414781642},"usedName":{"valueName":{"identifier":"addrSocketType"}},"qualification":null},{"reference":{"otherSlice":5966676263279217999},"usedName":{"constructorName":{"identifier":"Stream"},"constructorTypeName":{"identifier":"SocketType"}},"qualification":null},{"reference":{"otherSlice":327701426414781642},"usedName":{"valueName":{"identifier":"addrProtocol"}},"qualification":null},{"reference":{"otherSlice":2990950460556442721},"usedName":{"valueName":{"identifier":"getAddrInfo"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"filter"}},"qualification":null},{"reference":{"otherSlice":327701426414781642},"usedName":{"valueName":{"identifier":"addrFamily"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"otherSlice":6366556555504853542},"usedName":{"constructorName":{"identifier":"AF_INET6"},"constructorTypeName":{"identifier":"Family"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"null"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"head"}},"qualification":null},{"reference":{"otherSlice":2075613775210566552},"usedName":{"valueName":{"identifier":"bracketOnError"}},"qualification":null},{"reference":{"otherSlice":4272420466188907908},"usedName":{"valueName":{"identifier":"socket"}},"qualification":null},{"reference":{"otherSlice":4112987266023136759},"usedName":{"valueName":{"identifier":"sClose"}},"qualification":null},{"reference":{"otherSlice":7642706057452917817},"usedName":{"valueName":{"identifier":"setSocketOption"}},"qualification":null},{"reference":{"otherSlice":5653121259726360349},"usedName":{"constructorName":{"identifier":"ReuseAddr"},"constructorTypeName":{"identifier":"SocketOption"}},"qualification":null},{"reference":{"otherSlice":8664137520116127459},"usedName":{"valueName":{"identifier":"bind"}},"qualification":null},{"reference":{"otherSlice":327701426414781642},"usedName":{"valueName":{"identifier":"addrAddress"}},"qualification":null},{"reference":{"otherSlice":8045691691192437598},"usedName":{"valueName":{"identifier":"listen"}},"qualification":null},{"reference":{"otherSlice":8585375259984192072},"usedName":{"valueName":{"identifier":"maxListenQueue"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":6012126910783023571},"usedName":{"typeName":{"identifier":"ServiceName"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":1546470151414195006},"usedName":{"typeName":{"identifier":"Socket"}},"qualification":null}],"fragment":["listen' :: ServiceName -> IO Socket","listen' serv\n  = do proto <- getProtocolNumber \"tcp\"\n       let hints\n             = defaultHints{addrFlags = [AI_ADDRCONFIG, AI_PASSIVE],\n                            addrSocketType = Stream, addrProtocol = proto}\n       addrs <- getAddrInfo (Just hints) Nothing (Just serv)\n       let addrs' = filter (\\ x -> addrFamily x == AF_INET6) addrs\n           addr = if null addrs' then head addrs else head addrs'\n       bracketOnError\n         (socket (addrFamily addr) (addrSocketType addr)\n            (addrProtocol addr))\n         (sClose)\n         (\\ sock ->\n            do setSocketOption sock ReuseAddr 1\n               bind sock (addrAddress addr)\n               listen sock maxListenQueue\n               return sock)"],"instances":[],"language":{"extensions":["DeriveDataTypeable","ForeignFunctionInterface","TypeSynonymInstances","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}