{"sliceID":9068608194709951000,"uses":[{"reference":{"otherSlice":5854825192706528912},"usedName":{"constructorName":{"identifier":"ISource"},"constructorTypeName":{"identifier":"ISource"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"readIORef"}},"qualification":"I"},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":2109377013281436257},"usedName":{"valueName":{"identifier":"empty"}},"qualification":"S"},{"reference":{"otherSlice":4434023532649325206},"usedName":{"valueName":{"identifier":"readSource"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"when"}},"qualification":null},{"reference":{"otherSlice":675696118971413715},"usedName":{"valueName":{"identifier":"null"}},"qualification":"S"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"GHC.IO"},"usedName":{"valueName":{"identifier":"throwIO"}},"qualification":null},{"reference":{"otherSlice":8547266307614062940},"usedName":{"constructorName":{"identifier":"ConnectionClosedByPeer"},"constructorTypeName":{"identifier":"InvalidRequest"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"identifier":"min"}},"qualification":null},{"reference":{"otherSlice":6258463563638113276},"usedName":{"valueName":{"identifier":"length"}},"qualification":"S"},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":">"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"writeIORef"}},"qualification":"I"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"otherSlice":3674330957874520992},"usedName":{"valueName":{"identifier":"splitAt"}},"qualification":"S"},{"reference":{"otherSlice":3896990514858613071},"usedName":{"valueName":{"identifier":"leftoverSource"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"assert"}},"qualification":null},{"reference":{"otherSlice":5854825192706528912},"usedName":{"typeName":{"identifier":"ISource"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":8642306666063513779},"usedName":{"typeName":{"identifier":"ByteString"}},"qualification":null}],"fragment":["readISource :: ISource -> IO ByteString","readISource (ISource src ref)\n  = do count <- I.readIORef ref\n       if count == 0 then return S.empty else\n         do bs <- readSource src\n            when (S.null bs) $ throwIO ConnectionClosedByPeer\n            let toSend = min count (S.length bs)\n                count' = count - toSend\n            case () of\n                () | count' > 0 ->\n                     do I.writeIORef ref count'\n                        return bs\n                   | otherwise ->\n                     do let (x, y) = S.splitAt toSend bs\n                        leftoverSource src y\n                        assert (count' == 0) $ I.writeIORef ref count'\n                        return x"],"instances":[],"language":{"extensions":["MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"],"isInstance":false}}